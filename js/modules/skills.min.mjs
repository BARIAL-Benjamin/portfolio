// @ts-nocheck
import Skill from"./skill.min.mjs";export default class Skills{#e=document.getElementById("skillsForm");#t=document.getElementById("skillsList");#s=document.getElementById("name");#r=document.getElementById("description");#l=document.getElementById("level");#i=document.getElementById("skillsInfo");#o={skills:[]};#n=this.#a();constructor(e=null,t=null,s=null){if(this.#e=e||this.#e,this.#t=t||this.#t,this.#i=s||this.#i,this.#s=this.#e.querySelector("#name"),this.#r=this.#e.querySelector("#description"),this.#l=this.#e.querySelector("#level"),!Skills.testStorage)throw this.logger("Impossible d'utiliser localStorage","error"),new Error("Impossible d'utiliser localStorage");this.#c()||this.logger("App mal initialisé","warn")}static get testStorage(){return(()=>{try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),console.log("localStorage OK"),!0}catch(e){return console.warn("localStorage KO"),!1}})()}#c(){try{const e=localStorage.getItem(Skills.appName);return e&&(this.#o=JSON.parse(e)),this.#n=this.#a(),this.buildList(),this.save()}catch(e){return this.logger("Impossible d'initialiser l'app","error",e),!1}}#a(){try{const e=[];return this.#o.skills.forEach((t=>{e.push(new Skill({id:t}))})),e}catch(e){return this.logger("Impossible de récupérer les compétences","error",e),[]}}save(){try{return localStorage.setItem(Skills.appName,JSON.stringify(this.#o)),!0}catch(e){return this.logger("Impossible de sauvegarder l'app","error",e),!1}}addSkill(e,t,s=null){e&&t&&""!==e&&""!==t||(t=null),s&&""!==s||(s=null);try{const r=new Skill({name:e,level:t,description:s});this.#o.skills.push(r.sID),this.#n.push(r),this.save(),this.buildList(),this.logger("Compétence ajoutée","success")}catch(e){this.logger(e.message,"error",e)}}buildList(){try{this.#t.innerHTML="",this.#n.forEach((e=>{const t=document.createElement("li"),s=[{text:"Modifier",listener:()=>this.editSkill(e)},{text:"Supprimer",listener:()=>this.deleteSkill(e)}],r=function(e){const t=document.createElement("h3");return t.textContent=e,t}(e.name),l=function(e){const t=document.createElement("p");return t.textContent=e,t}(e.description),i=function(e){const t=document.createElement("p");return t.textContent=e,t.className="skillLevel",t}(e.level);t.append(r,l,i),s.forEach((e=>{const s=function({text:e,listener:t}){const s=document.createElement("button");return s.textContent=e,s.addEventListener("click",t),s}({text:e.text,listener:e.listener});t.appendChild(s)})),this.#t.appendChild(t),this.logger("Liste affiché")}))}catch(e){this.logger("Impossible de construire la liste des compétences","error",e)}}editSkill(e){try{return e?(this.#s.value=e.name,this.#r.value=e.description,this.#l.value=e.level,this.#e.querySelector("button").textContent="Modifier",this.#e.addEventListener("submit",(t=>{t.preventDefault(),e.name=this.#s.value,e.description=this.#r.value,e.level=this.#l.value,this.#n.splice(this.#n.indexOf(e),1),this.#o.skills.splice(this.#o.skills.indexOf(e.sID),1),localStorage.removeItem(e.sID),this.save(),this.buildList(),this.#e.reset(),this.#e.querySelector("button").textContent="Ajouter",this.logger("Compétence modifié","success")})),!0):(this.logger("Impossible de trouver la compétence","error"),!1)}catch(e){return this.logger("Impossible de modifier la compétence","error",e),!1}}deleteSkill(e){try{return e?(localStorage.removeItem(e.sID),this.#o.skills.splice(this.#o.skills.indexOf(e.sID),1),this.#n.splice(this.#n.indexOf(e),1),this.save(),this.buildList(),this.logger("Compétence supprimé","success"),!0):(this.logger("Impossible de trouver la compétence","error"),!1)}catch(e){return this.logger("Impossible de supprimer la compétence","error",e),!1}}logger(e,t="info",s=null){switch(t){case"info":this.#i.style.color="blue";break;case"warn":this.#i.style.color="orange";break;case"error":this.#i.style.color="red";break;case"success":this.#i.style.color="green";break;default:this.#i.style.color="black"}this.#i.textContent=e,s&&console.error(s)}static appName="Skills"}